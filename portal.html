<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Showroom Virtual</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style id="theme-style"> :root { --primary: #E31010; } </style>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Inter', sans-serif; }
        body { background: #000; color: #fff; }
        header { padding: 40px 20px; text-align: center; border-bottom: 1px solid #111; }
        #logo-loja { max-height: 70px; margin-bottom: 10px; }
        .nexus-label { font-size: 0.6rem; color: #333; letter-spacing: 3px; }

        .filter-section { max-width: 1100px; margin: 20px auto; padding: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
        .filter-section input, .filter-section select { 
            flex: 1; min-width: 180px; padding: 12px; background: #111; border: 1px solid #222; color: #fff; border-radius: 8px;
        }

        .grid { max-width: 1200px; margin: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; padding: 20px; }
        .card { background: #111; border-radius: 20px; border: 1px solid #222; overflow: hidden; transition: 0.4s; }
        .card:hover { border-color: var(--primary); transform: translateY(-5px); }
        .img-main { height: 230px; background-size: cover; background-position: center; }
        
        .ficha { display: flex; gap: 8px; padding: 15px 15px 5px; }
        .ficha span { font-size: 0.7rem; color: #777; background: #1a1a1a; padding: 3px 8px; border-radius: 4px; }
        
        .info { padding: 15px; }
        .price { font-size: 1.6rem; color: var(--primary); font-weight: 800; margin: 10px 0; }
        .btn-zap { display: block; background: #25D366; color: #fff; text-align: center; padding: 15px; border-radius: 12px; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <header>
        <img id="logo-loja" src="" style="display:none">
        <div class="nexus-label">POWERED BY NEXUS V12</div>
    </header>

    <div class="filter-section">
        <input type="text" id="f-texto" placeholder="Marca ou Modelo..." oninput="window.filtrar()">
        <select id="f-cambio" onchange="window.filtrar()">
            <option value="">C칙mbio (Todos)</option>
            <option value="Autom치tico">Autom치tico</option>
            <option value="Manual">Manual</option>
        </select>
        <input type="number" id="f-km" placeholder="KM M치xima" oninput="window.filtrar()">
    </div>

    <div id="showroom" class="grid"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, where, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { /* Sua Config Aqui */ };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const lojaId = new URLSearchParams(window.location.search).get('loja');

        let todosVeiculos = [];

        if(lojaId) {
            // Carrega Logo e Cor
            getDoc(doc(db, "configuracoes", lojaId)).then(s => {
                if(s.exists()){
                    const d = s.data();
                    if(d.corLoja) document.getElementById('theme-style').innerHTML = `:root { --primary: ${d.corLoja}; }`;
                    if(d.logoLoja) { const img = document.getElementById('logo-loja'); img.src = d.logoLoja; img.style.display = 'inline-block'; }
                }
            });

            // Carrega Carros
            onSnapshot(query(collection(db, "carros"), where("lojaId", "==", lojaId)), (snap) => {
                todosVeiculos = snap.docs.map(d => ({id: d.id, ...d.data()}));
                window.filtrar();
            });
        }

        window.filtrar = () => {
            const txt = document.getElementById('f-texto').value.toLowerCase();
            const cam = document.getElementById('f-cambio').value;
            const km = document.getElementById('f-km').value;

            const res = todosVeiculos.filter(v => {
                const bateTexto = v.modelo.toLowerCase().includes(txt) || v.marca.toLowerCase().includes(txt);
                const bateCambio = cam === "" || v.cambio === cam;
                const bateKm = km === "" || v.km <= Number(km);
                return bateTexto && bateCambio && bateKm && v.status !== 'vendido';
            });

            document.getElementById('showroom').innerHTML = res.map(v => `
                <div class="card">
                    <div class="img-main" style="background-image:url('${v.fotos[0]}')"></div>
                    <div class="ficha"><span>${v.ano}</span><span>${v.cambio}</span><span>${Number(v.km).toLocaleString()} KM</span></div>
                    <div class="info">
                        <h3>${v.marca} ${v.modelo}</h3>
                        <div class="price">R$ ${Number(v.preco).toLocaleString('pt-BR')}</div>
                        <a href="https://wa.me/55${v.vendedorWhats}" class="btn-zap">TENHO INTERESSE</a>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
